---
import Stats from '../components/Stats.astro';
import Features from '../components/Features.astro';
import HeroSection2 from '../components/HeroSection2.astro';
import Layout from '../layouts/Layout.astro';
import Testimonials from '../components/Testimonials.astro';
import CallToAction from '../components/CallToAction.astro';
import Blog from '../components/Blog.astro';
import Container from "../components/Container.astro";
---

<Layout title="Contact Us - Expresiv">
	<main class="space-y-40 mb-40">
		<div class="relative" id="home">
			<div aria-hidden="true" class="absolute inset-0 grid grid-cols-2 -space-x-52 opacity-40 dark:opacity-20">
				<div class="blur-[106px] h-56 bg-[conic-gradient(at_right,_var(--tw-gradient-stops))] from-indigo-200 via-slate-600 to-indigo-200"></div>
				<div class="blur-[106px] h-32 bg-gradient-to-r from-gray-200 via-gray-400 to-gray-600"></div>
			</div>
			<Container>
				<div class="relative pt-2 ml-auto">
					<section>
						<div class="py-8 lg:py-16 px-4 mx-auto max-w-screen-md">
							<h2 class="mb-4 text-4xl tracking-tight font-extrabold text-center text-gray-900 dark:text-white">Start Your Project</h2>
							<p class="mb-8 lg:mb-16 font-light text-center text-gray-500 dark:text-gray-400 sm:text-xl">Ready to grow your business? Fill out the form below and we'll get back to you within 24 hours with a free strategy proposal.</p>
							
							<!-- Success Message (hidden by default) -->
							<div id="success-message" class="hidden mb-6 p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800">
								<div class="flex items-center">
									<svg class="w-5 h-5 text-green-600 dark:text-green-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
										<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
									</svg>
									<p class="text-sm font-medium text-green-800 dark:text-green-300" id="success-text">Thank you! We'll get back to you within 24 hours.</p>
								</div>
							</div>

							<!-- Error Message (hidden by default) -->
							<div id="error-message" class="hidden mb-6 p-4 rounded-lg bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800">
								<div class="flex items-center">
									<svg class="w-5 h-5 text-red-600 dark:text-red-400 mr-3" fill="currentColor" viewBox="0 0 20 20">
										<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
									</svg>
									<p class="text-sm font-medium text-red-800 dark:text-red-300" id="error-text">Something went wrong. Please try again.</p>
								</div>
							</div>

							<form id="contact-form" class="space-y-8">
								<div>
									<label for="email" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Your email</label>
									<input 
										type="email" 
										id="email" 
										name="email"
										class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" 
										placeholder="name@example.com" 
										required
									>
								</div>
								<div>
									<label for="name" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-300">Your Name</label>
									<input 
										type="text" 
										id="name" 
										name="name"
										class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" 
										placeholder="John Doe" 
										required
									>
								</div>
								<div class="sm:col-span-2">
									<label for="message" class="block mb-2 text-sm font-medium text-gray-900 dark:text-gray-400">Your message</label>
									<textarea 
										id="message" 
										name="message"
										rows="6" 
										class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg shadow-sm border border-gray-300 focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500" 
										placeholder="Tell us about your project goals..."
										required
									></textarea>
								</div>
								<button 
									type="submit" 
									id="submit-button"
									class="relative flex h-11 w-full items-center justify-center px-6 before:absolute before:inset-0 before:rounded-full before:border before:border-transparent before:bg-primary/10 before:bg-gradient-to-b before:transition before:duration-300 hover:before:scale-105 active:duration-75 active:before:scale-95 dark:before:border-gray-700 dark:before:bg-gray-800 sm:w-max disabled:opacity-50 disabled:cursor-not-allowed"
								>
									<span class="relative text-base font-semibold text-primary dark:text-white" id="button-text">Get Free Proposal</span>
									<!-- Loading spinner (hidden by default) -->
									<svg class="hidden w-5 h-5 ml-2 animate-spin text-primary dark:text-white" id="loading-spinner" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
										<circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
										<path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
									</svg>
								</button>
							</form>
						</div>
					</section>
				</div>
			</Container>
		</div>
	</main>
</Layout>

<script>
	function initContactForm() {
		const form = document.getElementById('contact-form') as HTMLFormElement;
		const submitButton = document.getElementById('submit-button') as HTMLButtonElement;
		const buttonText = document.getElementById('button-text') as HTMLSpanElement;
		const loadingSpinner = document.getElementById('loading-spinner') as SVGElement;
		const successMessage = document.getElementById('success-message') as HTMLDivElement;
		const errorMessage = document.getElementById('error-message') as HTMLDivElement;
		const successText = document.getElementById('success-text') as HTMLParagraphElement;
		const errorText = document.getElementById('error-text') as HTMLParagraphElement;

		if (!form) return;

		form.addEventListener('submit', async (e) => {
			e.preventDefault();

			// Hide previous messages
			successMessage.classList.add('hidden');
			errorMessage.classList.add('hidden');

			// Show loading state
			submitButton.disabled = true;
			buttonText.textContent = 'Sending...';
			loadingSpinner.classList.remove('hidden');

			try {
				// Get form data and convert to URLSearchParams
				const formData = new FormData(form);
				const urlSearchParams = new URLSearchParams();
				for (const [key, value] of formData.entries()) {
					urlSearchParams.append(key, value.toString());
				}

				// Send to API as x-www-form-urlencoded
				const response = await fetch('/api/contact', {
					method: 'POST',
					headers: {
						'Content-Type': 'application/x-www-form-urlencoded'
					},
					body: urlSearchParams
				});

				const result = await response.json();

				if (result.success) {
					// Show success message
					successText.textContent = result.message || "Thank you! We'll get back to you within 24 hours.";
					successMessage.classList.remove('hidden');
					
					// Reset form
					form.reset();

					// Scroll to success message
					successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
				} else {
					// Show error message
					errorText.textContent = result.message || 'Something went wrong. Please try again.';
					errorMessage.classList.remove('hidden');
					
					// Scroll to error message
					errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
				}
			} catch (error) {
				console.error('Error submitting form:', error);
				errorText.textContent = 'Something went wrong. Please try again or email us directly at info@expresiv.com.au';
				errorMessage.classList.remove('hidden');
				errorMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
			} finally {
				// Reset button state
				submitButton.disabled = false;
				buttonText.textContent = 'Get Free Proposal';
				loadingSpinner.classList.add('hidden');
			}
		});
	}

	// Initialize on both DOMContentLoaded and astro:page-load for View Transitions
	document.addEventListener('DOMContentLoaded', initContactForm);
	document.addEventListener('astro:page-load', initContactForm);
</script>
